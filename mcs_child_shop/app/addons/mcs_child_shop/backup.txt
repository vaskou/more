function fn_mcs_get_all_parent_main_data()
{
	$result=array();
	$sync_data=array();
	$product_data=array();
	$data = db_get_array("SELECT * FROM ?:products");
	
	foreach($data as $k=>$v){
//		if($v['mcs_child_sync_product']=='Y'){
			$temp_sync_data['mcs_child_sync_product']=$v['mcs_child_sync_product'];
			$temp_sync_data['mcs_child_sync_images']=$v['mcs_child_sync_images'];
			$temp_sync_data['mcs_child_sync_files']=$v['mcs_child_sync_files'];
			unset($v['mcs_child_sync_product']);
			unset($v['mcs_child_sync_images']);
			unset($v['mcs_child_sync_files']);
			$v['status'] = 'D';
		    $v['timestamp'] = $v['updated_timestamp'] = time();
			array_push($sync_data,$temp_sync_data);
			array_push($product_data,$v);
//		}
	}
	
	$result=array('product_data'=>$product_data,'sync_data'=>$sync_data);
	
	return $result;
}

function fn_mcs_put_all_parent_main_data($data,$sync_data)
{
	try{
		foreach($data as $k=>$v){
			if($sync_data[$k]['mcs_child_sync_product']=='Y'){
				db_replace_into('products',$v);
			}
		}
	}
	catch(Exception $e){
		return 'Caught exception: '.$e->getMessage()."\n";
	}
}

function fn_mcs_get_all_descriptions()
{
	$result=array();
	$data = db_get_array("SELECT * FROM ?:product_descriptions");

	foreach($data as $k=>$v){
		if(!empty($v['mcs_child_product'])){
			$v['product']=$v['mcs_child_product'];
		}
		if(!empty($v['mcs_child_full_description'])){
			$v['full_description']=$v['mcs_child_full_description'];
		}
		unset($v['mcs_child_product']);
		unset($v['mcs_child_full_description']);
		array_push($result,$v);
	}
	
	return $result;
}

function fn_mcs_put_all_descriptions($data,$sync_data)
{
	try{
		foreach($data as $k=>$v){
			if($sync_data[$k]['mcs_child_sync_product']=='Y'){
				db_replace_into('product_descriptions',$v);
			}
		}
	}
	catch(Exception $e){
		return 'Caught exception: '.$e->getMessage()."\n";
	}
}

function fn_mcs_get_all_prices()
{
	$data = db_get_array("SELECT * FROM ?:product_prices");
	return $data;
}

function fn_mcs_put_all_prices($data,$sync_data)
{
	try{
		foreach($data as $k=>$v){
			if($sync_data[$k]['mcs_child_sync_product']=='Y'){
				db_replace_into('product_prices',$v);
			}
		}
	}
	catch(Exception $e){
		return 'Caught exception: '.$e->getMessage()."\n";
	}
}

function fn_mcs_put_all_product_categories($data,$sync_data)
{
	try{
		$products_categories=array(
			'category_id'=>1,
			'link_type'=>'M',
			'position'=>0
		);
		$_cids = array();
		foreach($data as $k=>$v){
			if($sync_data[$k]['mcs_child_sync_product']=='Y'){
				$products_categories['product_id']=$v['product_id'];
				db_replace_into("products_categories", $products_categories);
				$_cids[] = $products_categories['category_id'];
			}
		}
		fn_update_product_count($_cids);
	}
	catch(Exception $e){
		return 'Caught exception: '.$e->getMessage()."\n";
	}
}

function fn_mcs_get_all_product_options()
{
	$product_global_option_links=db_get_array("SELECT * FROM ?:product_global_option_links");
	$product_options=db_get_array("SELECT * FROM ?:product_options");
	$product_options_descriptions=db_get_array("SELECT * FROM ?:product_options_descriptions");
	$product_options_exceptions=db_get_array("SELECT * FROM ?:product_options_exceptions");
	$product_options_inventory=db_get_array("SELECT * FROM ?:product_options_inventory");
	$product_option_variants=db_get_array("SELECT * FROM ?:product_option_variants");
	$product_option_variants_descriptions=db_get_array("SELECT * FROM ?:product_option_variants_descriptions");
	
	$data=array(
		'product_global_option_links'=>$product_global_option_links,
		'product_options'=>$product_options,
		'product_options_descriptions'=>$product_options_descriptions,
		'product_options_exceptions'=>$product_options_exceptions,
		'product_options_inventory'=>$product_options_inventory,
		'product_option_variants'=>$product_option_variants,
		'product_option_variants_descriptions'=>$product_option_variants_descriptions
	);
	
	return $data;
}

function fn_mcs_put_all_product_options($data)
{
	try{
		foreach($data as $k=>$v){
			fn_mcs_multi_db_replace_into($k,$v);
		}
		
		$result=__('text_options_copied');
		return $result;
	}
	catch(Exception $e){
		return 'Caught exception: '.$e->getMessage()."\n";
	}
}

function fn_mcs_get_all_product_features()
{
	$product_features=db_get_array("SELECT feature_id, feature_code, company_id, feature_type, parent_id, display_on_product, display_on_catalog, display_on_header, status, position, comparison FROM ?:product_features");
	$product_features_descriptions=db_get_array("SELECT * FROM ?:product_features_descriptions");
	$product_features_values=db_get_array("SELECT * FROM ?:product_features_values");
	$product_feature_variants=db_get_array("SELECT * FROM ?:product_feature_variants");
	$product_feature_variant_descriptions=db_get_array("SELECT * FROM ?:product_feature_variant_descriptions");
	$ult_objects_sharing=db_get_array("SELECT * FROM ?:ult_objects_sharing WHERE share_object_type='product_features'");
	
	$data=array(
		'product_features'=>$product_features,
		'product_features_descriptions'=>$product_features_descriptions,
		'product_features_values'=>$product_features_values,
		'product_feature_variants'=>$product_feature_variants,
		'product_feature_variant_descriptions'=>$product_feature_variant_descriptions,
		'ult_objects_sharing'=>$ult_objects_sharing
	);
	
	return $data;
}

function fn_mcs_put_all_product_features($data)
{
	try{
		foreach($data as $k=>$v){
			fn_mcs_multi_db_replace_into($k,$v);
		}
		
		$result=__('text_features_copied');
		return $result;
	}
	catch(Exception $e){
		return 'Caught exception: '.$e->getMessage()."\n";
	}
}

function fn_mcs_db_connect_parent()
{
/*TODO: get params from addon settings*/
	$params = array(
	  'dbc_name' => 'parent',
	  'table_prefix' => 'cscart_'
	);
	db_initiate('localhost', 'vaskou', 'vaskou1!', 'cscart_parent', $params);
	db_connect_to($params, 'cscart_parent');
}

function fn_mcs_db_connect_child()
{
/*TODO: get params from addon settings*/
	$params = array(
	  'dbc_name' => 'child',
	  'table_prefix' => 'cscart_'
	);
	db_initiate('localhost', 'vaskou', 'vaskou1!', 'cscart_child', $params);
	db_connect_to($params, 'cscart_child');
}